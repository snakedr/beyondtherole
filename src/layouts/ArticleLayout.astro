---
import '../styles/global.css';
import HandwrittenNote from '../components/HandwrittenNote.astro';

interface Props {
	title: string;
	description: string;
	ogImage?: string;
}

const { title, description, ogImage } = Astro.props;
---

<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <meta name="description" content={description}>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/styles/global.css">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content={Astro.url.origin + Astro.url.pathname}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    {ogImage && <meta property="og:image" content={Astro.url.origin + ogImage}>}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content={Astro.url.origin + Astro.url.pathname}>
    <meta property="twitter:title" content={title}>
    <meta property="twitter:description" content={description}>
    {ogImage && <meta property="twitter:image" content={Astro.url.origin + ogImage}>}

</head>
<body class="is-lite bg-lite-bg text-lite-text">
    <HandwrittenNote />
    <button id="theme-toggle-btn" class="fixed top-4 right-4 z-50 flex items-center gap-2 px-3 py-2 rounded-full bg-slate-200/50 dark:bg-slate-800/50 backdrop-blur-sm shadow-lg border border-white/20">
        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m8.66-15.66l-.707.707M4.34 19.66l-.707.707M21 12h-1M4 12H3m15.66 8.66l-.707-.707m-12.728 0l.707.707" />
        </svg>
        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-400 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
        <span id="toggle-text" class="font-sans text-sm font-medium text-slate-700 dark:text-slate-300"></span>
    </button>
    <slot />
    <script src="/scripts/autotest.js" is:inline></script>
    <script>
        document.addEventListener('astro:page-load', () => {
            const toggleButton = document.getElementById('theme-toggle-btn');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const toggleText = document.getElementById('toggle-text');
            const body = document.body;

            function updateToggle(isThink) {
                if (isThink) {
                    body.classList.remove('is-lite');
                    body.classList.add('is-think');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                    toggleText.textContent = 'Think';
                } else {
                    body.classList.remove('is-think');
                    body.classList.add('is-lite');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                    toggleText.textContent = 'Lite';
                }
            }

            // Set initial state from localStorage
            const savedTheme = localStorage.getItem('theme');
            // If there's a saved theme, use it. Otherwise, check system preference.
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isInitiallyThink = savedTheme ? savedTheme === 'think' : prefersDark;
            
            updateToggle(isInitiallyThink);

            toggleButton.addEventListener('click', () => {
                const isCurrentlyThink = body.classList.contains('is-think');
                updateToggle(!isCurrentlyThink);
                localStorage.setItem('theme', !isCurrentlyThink ? 'think' : 'lite');
            });
        });
    </script>
</body>
</html>